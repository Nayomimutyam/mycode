<?php
/**
Plugin Name: Custom Plugin
Description: Sample Plugin
Author: Venu
**/

function new_db_create() {
	global $wpdb;
	

	$table_name = $wpdb->prefix . 'customtable';
	
	$charset_collate = $wpdb->get_charset_collate();

	$sql = "CREATE TABLE $table_name (
		id int(10) NOT NULL AUTO_INCREMENT,
		firstname varchar(55) NOT NULL,
		lastname varchar(55) NOT NULL,
		email varchar(55) NOT NULL,
		phone varchar(55) NOT NULL,
		PRIMARY KEY  (id)
	) $charset_collate;";

	require_once( ABSPATH . 'wp-admin/includes/upgrade.php' );
	dbDelta( $sql );
	
}
register_activation_hook( __FILE__, 'new_db_create' );


function my_plugin_remove_database() {
     global $wpdb;
     $table_name = $wpdb->prefix . 'customtable';
     $sql = "DROP TABLE IF EXISTS $table_name";
     $wpdb->query($sql);
     delete_option("my_plugin_db_version");
}  
register_deactivation_hook( __FILE__, 'my_plugin_remove_database' );

function my_add_admin_page(){

add_menu_page('Form Title', 'Registration Form', 'manage_options','form-menu-options','scipts_page','', 200);   
add_submenu_page(
    'form-menu-options',       // parent slug
    'Settings ',    // page title
    'Settings',             // menu title
    'manage_options',           // capability
    'form-sub-menu-options', // slug
    'scipts_sub_page' // callback
); 

}
add_action('admin_menu','my_add_admin_page'); 


function scipts_page(){
	
	?>
	<div class="wrap">
	<h2> Registration Form Here</h2>
	<form method="POST" action="<?php echo $_SERVER['REQUEST_URI']; ?>">
	
	
	
	<div class="form-group">
	<label for="firstname" > First Name</label>
	<input type="text" name="firstname" class="form-control" />
	</div><br/>
	<div class="form-group">
	<label for="lastname" > Last Name</label>
	<input type="text" name="lastname" class="form-control" />
	</div><br/>
	<div class="form-group">
	<label for="email" > Email</label>
	<input type="text" name="email" class="form-control" />
	</div><br/>
	<div class="form-group">
	<label for="phone" > Phone Number</label>
	<input type="text" name="phone" class="form-control" />
	</div>
	<input type="submit" name="submit" value = "Submit" class="button button-primary" />
	
	
	</form>
	</div>
	
	<?php
	
if($_POST['submit']) {
	global $wpdb;
	$table_name ='wp_customtable';
	$firstname = $_POST['firstname'];
	$lastname = $_POST['lastname'];
	$email = $_POST['email'];
	$phone = $_POST['phone'];
	
	$success = $wpdb->insert("wp_customtable", array(
   "firstname" => $firstname,
   "lastname" => $lastname,
   "email" => $email,
   "phone" => $phone ,
));
	if($success) {
		echo ' Inserted successfully';
      } else {
		  echo 'not inserted values in DB';
	  }
}	
	
}
function form_capture(){
	
	if(array_key_exists('submit','$_POST'))
	{
		
		$to = "submit@gmail.com";
		$subject = " Registration form";
		$body  = " ";
		
		$body .= 'Name : ' .$_POST['Name']. '<br/>';
		$body .= 'Email : ' .$_POST['email']. '<br/>';
		wp_mail($to,$subject,$body);
		
	}
	
	
	
}
add_action('wp_head', 'form_capture');
function scipts_sub_page(){
	
	?>
	<div class="wrap">
	<h2> Email Update Form Here</h2>
	<form method="POST" action="">
	<label for="Email Address">Update Email Address : </label>
	<input type="text" name="your_email" class="form-control">
	
	<input type="submit" name="email_submit" Value="Update Email" class="button button-primary">
	</form>
	</div>
			
	<?php
	
}
add_action('ex_form', 'scipts_sub_page');

 


?>
